# 競プロ情報記録用ブログページの制作課程

## 背景
ひと昔前に第二のTwitterを作りたいな～って思った時に自分で色々調整/遊んだり出来るものを制作したのが[このブログ](https://apiros3.github.io/blog)で、単純な話"blog-md"というディレクトリ配下に入れたmdファイルをhtml化⇒ブログページに掲載する、ということができるようにしたことがありました。

最近作問する機会も増えて来て、将来github.ioをそのまま自分のサイトに移そうかな～とか思った時に競プロ専用ページを作りたい！となり、表現の幅を増やすために今回追加制作に至りました。

また、ローカルとクラウドに保存が効くので
* 大事な情報を保存できる
* PCが変わった時にpullするだけで最新の状態を取得できる
* インターネット接続の無い環境で記事を書き溜めれる

と色々便利だったりします。 

という訳で、mdファイルを書くだけで、Qiitaにあるような記事と似たフォーマットで何かに変換されるような工夫を行ったものが今回のサイトです。

## 元々あった機能/追加した機能

前のブログページからあった機能：
* mdファイルをhtmlに変換し、main pageに保管
* 日付やタイトル表示などの単純な情報
* クエリ指定で特定のブログを開く

今回追加して、ブログページにも足した機能：
* [ジャンルの追加ジャンル毎の記事表示](#ジャンル毎の記事表示)

今回追加して、競プロページに足した機能：
* [LaTeX式を綺麗に表示](#LaTeX式を綺麗に表示)
* [問題文みたいな枠の追加](#問題文みたいな枠の追加)（blockquoteのデザイン）
* [言語スニペットにsyntax highlightingを付ける](#syntax-highlight)

## 追加した機能について

### ジャンル毎の記事表示

色んなジャンルの記事を書いたりするかもしれないと思い、ジャンル別で保存できるようにしました。
pythonで各mdファイルを処理しているときに、もし{ジャンル}_{タイトル}.mdという形になっているなら、その記事をそのジャンルに割り振るようにしています。また、ファイル名に"\_"が存在しない場合は、ジャンルを"Other"としています。例えば、このファイルは"制作物_競プロ用ブログ環境.md"という名前で保存されています。

render_blog.jsの中で、{ジャンル,タイトル,制作日}のタプルの配列をジャンル名でソートしています。また、ジャンル"Other"が必ず一番最後に、それ以外の場合はジャンル名昇順⇒更新日降順でソートしています。

ソートfunctionの参考：
```
function sortFunction(a, b) {
    if (a[0] === b[0]) {
        if (a[2] < b[2]) return 1;
        if (a[2] > b[2]) return -1;
        return 0;
    }
    else if (a[0] == "Other:") return 1;
    else if (b[0] == "Other:") return -1;
    else {
        return (a[0] < b[0]) ? -1 : 1;
    }
}
```

### LaTeX式を綺麗に表示

現在使っているmd⇒htmlの処理はpythonのmarkdownライブラリの物で、LaTeX⇒式には(知る限り)対応しておらず、書いた式がそのまま表示されていました。

今回はLaTeX⇒式のために、Katex ver0.11.1を使うことにしました。
HTMLのheadに：
```
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
```
を足して、python上で正しいフォーマットに式を書き直せばLaTeX化してくれます。（便利！）

例：<br>
> O(\frac {\sqrt{K\,log^2N}} {NM+Q}) <br>
> $O(\frac {\sqrt{K\,log^2N}} {NM+Q})$

### 問題文みたいな枠の追加

パッと見他のサイトのデザインがどうなっているかと比較しながら、色はGitHub Color Paletteの中から選択しました。今後opacity変えたくなるかもと思い念のためrgba設定です。

```
blockquote {
    background-color: rgba(33,38,45,1);
	border-left:	4px solid #ccc;
	margin:			0px 20px;
	padding:		1px;
}
```

### Syntax Highlight

調べた感じhighlight.jsが良さそうだったので、これを使うことにしました。
今回は、
* cpp
* css
* javascript
* markdown
* python

のみに対応させています。
HTMLのheadに

```
<link rel="stylesheet" href="highlight/styles/github-dark-dimmed.min.css">
<script src="highlight/highlight.min.js"></script>
```

を追加して、bodyの最後に

```
<script>
    hljs.highlightAll();
</script>
```

を置くだけで良くて、非常に便利です。重宝しています。

## 最後に

今後やりたいこととしては、cssを用いてコードのスニペットが特定の長さを超えた場合にスクロール可能にする、などの個人的な要件が主です。
最低限のことが出来るようにはなったので一旦ここでおしまいとしています。<s>(CSS苦手すぎてあまり触れていたくないので…)</s>
